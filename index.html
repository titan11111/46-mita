<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>白磁の匙</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html,body { height:100%; }
    body {
      font-family: "Yu Gothic", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background:#0b0e11; color:#e9eef5; overflow:hidden;
    }

    #gameContainer { position:relative; width:100vw; height:100vh; cursor:pointer; }

    /* 背景（実画像＋薄いグラデ） */
    #background{
      position:absolute; inset:0; z-index:1;
      background: linear-gradient(180deg,#0f141a 0%, #0b0e11 60%, #080a0c 100%);
      background-size:cover; background-position:center; background-repeat:no-repeat;
      transition:opacity .35s ease;
    }

    /* テキストUI */
    #textArea{
      position:absolute; left:0; right:0; bottom:0; z-index:5;
      background:rgba(3,6,9,.82); border-top:2px solid rgba(255,255,255,.06);
      min-height:28vh; padding:22px 22px 28px; backdrop-filter: blur(2px);
    }
    #speakerName{ font-size:14px; color:#93b4ff; margin-bottom:8px; min-height:18px; letter-spacing:.04em; }
    #mainText{ font-size:16px; line-height:1.9; letter-spacing:.02em; }
    .fade { animation: fade .35s ease; }
    @keyframes fade { from{opacity:0} to{opacity:1} }

    /* 選択肢 */
    #choiceArea{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:32vh; z-index:6; display:flex; flex-direction:column; gap:12px; max-width:86vw;
    }
    .choice-button{
      padding:12px 16px; font-size:15px; border-radius:10px; cursor:pointer;
      background:rgba(16,32,64,.72); color:#eaf2ff; border:1px solid rgba(108,163,255,.35);
      transition:.18s ease; box-shadow: 0 6px 16px rgba(0,0,0,.35) inset;
    }
    .choice-button:hover{ background:rgba(28,52,92,.85); transform: translateY(-1px); }

    /* コントロール */
    #controls{
      position:absolute; top:16px; right:16px; z-index:8; display:flex; gap:8px;
    }
    #controls button{
      padding:8px 12px; font-size:12px; border-radius:8px; cursor:pointer;
      background:rgba(24,24,28,.8); color:#dfe7ff; border:1px solid rgba(255,255,255,.1);
    }
    #controls button:hover{ background:rgba(40,44,52,.9); }

    /* デバッグ */
    .hidden{ display:none; }
    #debugPanel{
      position:absolute; top:16px; left:16px; z-index:8;
      background:rgba(0,0,0,.75); border:1px solid rgba(255,255,255,.2);
      padding:10px 12px; border-radius:8px; font-size:12px; color:#b6c7ff;
    }
    #debugPanel div{ margin:2px 0; }

    /* ログ */
    #logPanel{
      position:absolute; inset:0; z-index:9; background:rgba(6,9,12,.95);
      display:flex; flex-direction:column;
    }
    #logHeader{ display:flex; justify-content:space-between; align-items:center; padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.08); }
    #logHeader h3{ font-size:16px; color:#bcd1ff; }
    #logContent{ padding:14px 16px; overflow:auto; flex:1; }
    .log-entry{ margin-bottom:10px; padding-bottom:8px; border-bottom:1px dashed rgba(255,255,255,.06); }
    .log-speaker{ font-weight:bold; color:#93b4ff; margin-bottom:4px; }

    /* 開始画面 */
    .start-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      background: rgba(0,0,0,0.3);
      position: absolute;
      inset: 0;
      z-index: 10;
    }
    .start-text {
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      padding: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      background: rgba(0,0,0,0.5);
    }

    /* スマホ対応 */
    @media (max-width: 480px) {
      #textArea { min-height: 35vh; padding: 16px; }
      #choiceArea { bottom: 38vh; max-width: 92vw; }
      .choice-button { padding: 14px 16px; font-size: 16px; }
      #controls { top: 10px; right: 10px; gap: 6px; }
      #controls button { padding: 6px 10px; font-size: 11px; }
      #debugPanel { top: 10px; left: 10px; padding: 8px 10px; font-size: 11px; }
      .start-text { font-size: 16px; }
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <!-- 背景 -->
    <div id="background"></div>

    <!-- 開始画面 -->
    <div id="startScreen" class="start-screen">
      <div class="start-text">
        <div style="font-size: 24px; margin-bottom: 10px;">白磁の匙</div>
        <div>クリックまたはタップで開始</div>
      </div>
    </div>

    <!-- テキスト -->
    <div id="textArea">
      <div id="speakerName"></div>
      <div id="mainText">ゲーム準備中...</div>
    </div>

    <!-- 選択肢 -->
    <div id="choiceArea"></div>

    <!-- 操作 -->
    <div id="controls">
      <button id="btnLog">LOG</button>
      <button id="btnDebug">DEBUG</button>
      <button id="btnReset">リセット</button>
    </div>

    <!-- デバッグ -->
    <div id="debugPanel" class="hidden">
      <div>EVID: <span id="dbgEvid">0</span></div>
      <div>TRUST: <span id="dbgTrust">0</span></div>
      <div>SHADOW: <span id="dbgShadow">0</span></div>
      <div>SCENES: <span id="dbgScenes">0</span>/<span id="dbgMax">0</span></div>
    </div>

    <!-- ログ -->
    <div id="logPanel" class="hidden">
      <div id="logHeader">
        <h3>バックログ</h3>
        <button id="btnCloseLog">閉じる</button>
      </div>
      <div id="logContent"></div>
    </div>
  </div>

  <script>
    console.log('ゲームスクリプト開始');

    // 画像（プレースホルダー）
    const BG = {
      title:      'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzFhMjMzYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPueZveeggeOBruWMmTwvdGV4dD48L3N2Zz4=',
      gate:       'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzJkM2E0ZiIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPumWgOWPozwvdGV4dD48L3N2Zz4=',
      genkan:     'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzM0MzQzNCIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPueOhemWouOAkOaaguOBhOOBgTwvdGV4dD48L3N2Zz4=',
      living:     'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzRhNGEzYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuW6nOmWkzwvdGV4dD48L3N2Zz4=',
      kitchen:    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzNhNGEzYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuWPsOaJgDwvdGV4dD48L3N2Zz4=',
      hallway:    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzJhMmEzYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuW7ijwvdGV4dD48L3N2Zz4=',
      silhouette: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzFhMWExYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuW9seOAkOmglzwvdGV4dD48L3N2Zz4=',
      study:      'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzNhMzAyYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuabuuaWjuWupDwvdGV4dD48L3N2Zz4=',
      dining:     'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzRhNDA0YSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPumjn+WgjDwvdGV4dD48L3N2Zz4=',
      storage:    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzJhMmEyYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPueJqeaaPzwvdGV4dD48L3N2Zz4=',
      mirror:     'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzNhM2EzYSIvPjx0ZXh0IHg9IjQwMCIgeT0iMzAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPumbnTwvdGV4dD48L3N2Zz4='
    };

    // DOM要素
    const bgEl = document.getElementById('background');
    const speakerEl = document.getElementById('speakerName');
    const mainTextEl = document.getElementById('mainText');
    const choiceArea = document.getElementById('choiceArea');
    const startScreen = document.getElementById('startScreen');
    const dbg = {
      panel: document.getElementById('debugPanel'),
      evid: document.getElementById('dbgEvid'),
      trust: document.getElementById('dbgTrust'),
      shadow: document.getElementById('dbgShadow'),
      scenes: document.getElementById('dbgScenes'),
      max: document.getElementById('dbgMax')
    };
    const logPanel = document.getElementById('logPanel');
    const logContent = document.getElementById('logContent');

    console.log('DOM要素取得完了');

    // ゲーム状態
    let state, isRunning = false, gameStarted = false;

    // イベントリスナー設定
    document.getElementById('btnDebug').addEventListener('click', () => {
      console.log('DEBUGボタン押下');
      dbg.panel.classList.toggle('hidden');
    });

    document.getElementById('btnLog').addEventListener('click', () => {
      console.log('LOGボタン押下');
      logPanel.classList.remove('hidden');
      renderLog();
    });

    document.getElementById('btnCloseLog').addEventListener('click', () => {
      console.log('ログ閉じるボタン押下');
      logPanel.classList.add('hidden');
    });

    document.getElementById('btnReset').addEventListener('click', () => {
      console.log('リセットボタン押下');
      if(confirm('最初からはじめます。')) {
        init();
      }
    });

    // ゲーム開始イベント
    document.getElementById('gameContainer').addEventListener('click', (e) => {
      console.log('画面クリック');
      
      // ボタンクリックは除外
      if (e.target.closest('button')) {
        console.log('ボタンクリックのため除外');
        return;
      }

      // ログパネルが開いている時は除外
      if (!logPanel.classList.contains('hidden')) {
        console.log('ログパネル表示中のため除外');
        return;
      }

      // ゲーム開始前の場合
      if (!gameStarted) {
        console.log('ゲーム開始実行');
        start();
        return;
      }

      // 選択肢が表示されていない && ゲーム進行中でない場合のみ進行
      if (choiceArea.children.length === 0 && !isRunning) {
        console.log('次のシーンへ進行');
        nextScene();
      }
    });

    // ゲーム初期化
    function init() {
      console.log('ゲーム初期化開始');
      
      state = {
        evid: 0,
        trust: 0,
        shadow: 0,
        scenesSeen: 0,
        maxScenes: 10,
        visited: new Set(),
        log: []
      };
      
      isRunning = false;
      gameStarted = false;
      
      changeBackground(BG.title);
      setText('', 'ゲーム準備完了');
      choiceArea.innerHTML = '';
      startScreen.style.display = 'flex';
      updateDebug();
      logContent.innerHTML = '';
      logPanel.classList.add('hidden');
      
      console.log('ゲーム初期化完了');
    }

    // ゲーム開始
    function start() {
      console.log('ゲーム開始');
      
      gameStarted = true;
      isRunning = true;
      startScreen.style.display = 'none';
      
      changeBackground(BG.gate);
      say('', '午後四時過ぎ。山裾の屋敷の前で、私は足を止めた。風もないのに風鈴が鳴っている。');
      
      setTimeout(() => {
        isRunning = false;
        console.log('最初のシーン表示完了、クリックで次へ');
      }, 900);
    }

    // 次のシーン
    function nextScene() {
      console.log('次のシーン開始');
      
      // 終了チェック
      if (state.scenesSeen >= state.maxScenes) {
        console.log('規定シーン数到達、エンディング判定');
        endByFormula('規定到達');
        return;
      }

      isRunning = true;
      
      // 未訪問優先で20シーンから抽選
      const pool = scenes.map((_, i) => i).filter(i => !state.visited.has(i));
      const idx = (pool.length > 0) ? choice(pool) : Math.floor(Math.random() * scenes.length);
      
      state.visited.add(idx);
      state.scenesSeen++;
      updateDebug();
      
      console.log(`シーン${idx}を実行中`);
      playScene(scenes[idx]);
    }

    // シーン実行
    function playScene(sc) {
      console.log('シーン実行:', sc.text.substring(0, 20) + '...');
      
      if (sc.bg) changeBackground(sc.bg);
      say(sc.speaker || '', sc.text);
      
      showChoices(sc.choices.map(c => ({
        label: c.label,
        run: () => {
          console.log('選択肢選択:', c.label);
          applyDelta(c.delta || {});
          addLog(sc.speaker || '', `[選択] ${c.label}`);
          
          if (endByFormula('即時判定')) return;
          
          setTimeout(() => {
            isRunning = false;
            console.log('選択肢処理完了、クリックで次へ');
          }, 280);
        }
      })));
    }

    // 選択肢表示
    function showChoices(list) {
      choiceArea.innerHTML = '';
      
      list.forEach(item => {
        const b = document.createElement('button');
        b.className = 'choice-button fade';
        b.textContent = item.label;
        b.addEventListener('click', (e) => {
          e.stopPropagation();
          choiceArea.innerHTML = '';
          item.run();
        });
        choiceArea.appendChild(b);
      });
      
      isRunning = false;
      console.log('選択肢表示完了');
    }

    // テキスト表示
    function say(speaker, text) {
      setText(speaker, text);
      addLog(speaker || 'ナレーション', text);
    }

    function setText(speaker, text) {
      speakerEl.textContent = speaker;
      mainTextEl.classList.remove('fade');
      void mainTextEl.offsetWidth;
      mainTextEl.classList.add('fade');
      mainTextEl.textContent = text;
    }

    // 背景変更
    function changeBackground(path) {
      bgEl.style.opacity = 0;
      setTimeout(() => {
        bgEl.style.backgroundImage = `url(${path})`;
        bgEl.style.opacity = 1;
      }, 150);
    }

    // ユーティリティ
    function addLog(speaker, text) {
      state.log.push({ speaker, text });
    }

    function renderLog() {
      logContent.innerHTML = '';
      state.log.forEach(ent => {
        const d = document.createElement('div');
        d.className = 'log-entry';
        d.innerHTML = `<div class="log-speaker">${ent.speaker}</div><div>${ent.text}</div>`;
        logContent.appendChild(d);
      });
    }

    function applyDelta(d) {
      if ('evid' in d) state.evid = Math.max(0, state.evid + d.evid);
      if ('trust' in d) state.trust = state.trust + d.trust;
      if ('shadow' in d) state.shadow = Math.max(0, state.shadow + d.shadow);
      updateDebug();
      console.log(`パラメータ更新: EVID=${state.evid}, TRUST=${state.trust}, SHADOW=${state.shadow}`);
    }

    function updateDebug() {
      dbg.evid.textContent = state.evid;
      dbg.trust.textContent = state.trust;
      dbg.shadow.textContent = state.shadow;
      dbg.scenes.textContent = state.scenesSeen;
      dbg.max.textContent = state.maxScenes;
    }

    function choice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // 7エンド数式判定
    function endByFormula(reason) {
      const E = state.evid, T = state.trust, S = state.shadow;
      
      console.log(`エンディング判定: E=${E}, T=${T}, S=${S}, reason=${reason}`);

      if (E >= 5 && S >= 3 && T >= 1) return showEnding(1,
        '来客のために整えた応接室。銀のスプーン、写真立て、紙切れ。全員の顔色が変わった。何も言わずに湯を沸かしに戻る。');

      if (E >= 4 && T <= -1) return showEnding(4,
        '応接の空気は氷のように冷たくなった。「あなたには、もうお願いできません」玄関で靴紐が震えた。');

      if (S >= 5 && E < 3) return showEnding(5,
        '廊下に立つ背の高い影。灯りが揺れ、息が詰まる。冷たい気配に包まれ、意識が遠のいた。');

      if (T >= 3 && E >= 2 && S <= 2) return showEnding(6,
        '証拠は片づけた。来客は笑顔で帰る。奥様と短く目が合う。胸の奥に静かな重みだけが残った。');

      if (T >= 2 && S >= 3 && E < 4) return showEnding(3,
        '当主の低い声。「お前はよく見ているな」私はただ頷き、茶を注いだ。');

      if (T >= 1 && S >= 4 && E >= 1) return showEnding(2,
        '静茶の囁き。「ここだけの話にしましょう」私は小さく礼をして台所へ戻った。');

      if (S >= 6) return showEnding(7,
        '暗がりに裸足の人影。「幽霊だ！」気づけば裸足のまま外にいた。後で分かった。あれは人だった。');

      // 終了条件未達。規定到達のときは強制でEND6
      if (reason === '規定到達') {
        return showEnding(6,
          '来客は何事もなく帰った。私は道具を拭き直し、戸を静かに閉めた。');
      }
      
      return false;
    }

    // エンディング表示
    function showEnding(no, text) {
      console.log(`エンディング${no}表示`);
      
      changeBackground(BG.silhouette);
      setText('', `${text}\n\n— END ${no} —`);
      choiceArea.innerHTML = '';
      isRunning = false;
      gameStarted = false;
      
      return true;
    }

    // シーンデータ（20シーン）
    const scenes = [
      // 1 応接：スプーン
      {
        bg: BG.living, speaker: '',
        text: '応接のテーブル。銀のスプーンの向きがさっきと違う。奥様は扉から「それは後で私が」。',
        choices: [
          { label: '磨いて棚に戻す', delta: { trust: +1 } },
          { label: 'ポケットにしまう', delta: { evid: +1, trust: -1 } }
        ]
      },
      // 2 廊下の足音
      {
        bg: BG.hallway, speaker: '',
        text: '廊下の奥で「コツ…コツ…」。静茶は口を半開きのまま固まっている。',
        choices: [
          { label: '音の方へ行く', delta: { shadow: +1 } },
          { label: '作業に戻る', delta: { trust: +1 } }
        ]
      },
      // 3 花瓶の紙
      {
        bg: BG.kitchen, speaker: '',
        text: '花瓶の底に濡れた紙切れ。「見ている」の文字が滲む。風はないのに花が揺れる。',
        choices: [
          { label: '紙を読む', delta: { evid: +1, shadow: +1 } },
          { label: '捨てる', delta: { trust: +1 } }
        ]
      },
      // 4 書斎：写真の裏
      {
        bg: BG.study, speaker: '',
        text: '写真立ての裏から買い物リスト。背後で当主の声。「それは…誰に見せる？」',
        choices: [
          { label: '当主に渡す', delta: { trust: +1 } },
          { label: '黙って仕舞う', delta: { evid: +1, trust: -1, shadow: +1 } }
        ]
      },
      // 5 台所：声まね
      {
        bg: BG.kitchen, speaker: '静茶',
        text: '「古い客って知ってます？ 真夜中に台所で、誰かの声をまねるんです」廊下から私の声が「おいで」。',
        choices: [
          { label: '確かめに行く', delta: { shadow: +1 } },
          { label: '無視する', delta: { trust: +1 } }
        ]
      },
      // 6 客間：灯が消える
      {
        bg: BG.dining, speaker: '',
        text: '庭の灯が一つずつ消える。残り一つの横に背の高い影。',
        choices: [
          { label: '外へ出る', delta: { shadow: +1 } },
          { label: '窓を閉めて戻る', delta: { trust: +1 } }
        ]
      },
      // 7 廊下：奥様の囁き
      {
        bg: BG.hallway, speaker: '奥様',
        text: '「顔色が悪いわね」柔らかな笑み。だが耳元で、私の声で「逃げなさい」。',
        choices: [
          { label: '証拠を見せる', delta: { trust: +1, evid: +1 } },
          { label: '無言で通る', delta: { trust: -1, shadow: +1 } }
        ]
      },
      // 8 台所：鍵の引き出し
      {
        bg: BG.kitchen, speaker: '',
        text: '鍵の引き出しがわずかに開いている。中に黄ばんだ封筒。',
        choices: [
          { label: '開ける', delta: { evid: +1, shadow: +1 } },
          { label: '閉める', delta: { trust: +1 } }
        ]
      },
      // 9 玄関：靴が一足多い
      {
        bg: BG.genkan, speaker: '',
        text: '玄関の靴が一足多い。奥様は見ないふりで通り過ぎる。',
        choices: [
          { label: '揃えて奥へ', delta: { trust: +1 } },
          { label: '誰のか確かめる', delta: { evid: +1, shadow: +1 } }
        ]
      },
      // 10 食器棚：枚数が合わない
      {
        bg: BG.living, speaker: '',
        text: '奥様はお皿の枚数を何度も数え直す。結果は同じなのに首を傾げる。',
        choices: [
          { label: '記録しておく', delta: { evid: +1 } },
          { label: '気にせず進む', delta: {} }
        ]
      },
      // 11 洗濯：干してない衣
      {
        bg: BG.living, speaker: '',
        text: '取り込んだ洗濯物に、干していない衣が混ざっていた。「私のじゃない」と奥様。',
        choices: [
          { label: '確認して返す', delta: { trust: +1 } },
          { label: 'タグを調べる', delta: { evid: +1, shadow: +1 } }
        ]
      },
      // 12 庭：当主が塩を撒く
      {
        bg: BG.gate, speaker: '当主',
        text: '当主が庭に塩を撒く。「昨日と同じ場所じゃない」小声でつぶやく。',
        choices: [
          { label: '理由を聞く', delta: { trust: -1, shadow: +1 } },
          { label: '黙って掃除する', delta: { trust: +1 } }
        ]
      },
      // 13 時計：止まっているのに
      {
        bg: BG.hallway, speaker: '奥様',
        text: '廊下の時計は止まっているのに、奥様は時刻を言い当てる。',
        choices: [
          { label: '驚かず頷く', delta: { trust: +1 } },
          { label: '理由を尋ねる', delta: { trust: -1, shadow: +1 } }
        ]
      },
      // 14 部屋締切
      {
        bg: BG.living, speaker: '静茶',
        text: '静茶が勝手に部屋を締め切る。「空気が逃げるから」',
        choices: [
          { label: '従う', delta: { trust: +1 } },
          { label: '窓を開ける', delta: { trust: -1, shadow: +1 } }
        ]
      },
      // 15 物置：棚の奥
      {
        bg: BG.storage, speaker: '当主',
        text: '当主が棚の奥を何度も覗く。中には何もない。',
        choices: [
          { label: '一緒に確認', delta: { trust: +1, evid: +1 } },
          { label: '放っておく', delta: {} }
        ]
      },
      // 16 鏡：知らない肩
      {
        bg: BG.mirror, speaker: '',
        text: '鏡面を拭くと、背後に知らない肩が映る。「それは…おまえには重い」',
        choices: [
          { label: '渡す', delta: { trust: +1 } },
          { label: 'ポケットに入れる', delta: { evid: +1, trust: -1, shadow: +1 } }
        ]
      },
      // 17 配膳：一人分多い
      {
        bg: BG.dining, speaker: '奥様',
        text: '夕食の配膳で一人分多く用意させられる。「念のため」',
        choices: [
          { label: '黙って揃える', delta: { trust: +1, shadow: +1 } },
          { label: '数を直す', delta: { trust: -1, evid: +1 } }
        ]
      },
      // 18 廊下：見えない誰かに会釈
      {
        bg: BG.hallway, speaker: '静茶',
        text: '静茶が見えない誰かに会釈。こちらに気づくと話題を変える。',
        choices: [
          { label: '誰かいたか聞く', delta: { trust: -1, shadow: +1 } },
          { label: '見なかったふり', delta: { trust: +1 } }
        ]
      },
      // 19 庭：掘り返す
      {
        bg: BG.gate, speaker: '静茶',
        text: '静茶が地面を掘り返し、古い鍵を見つける。渡すか迷っている。',
        choices: [
          { label: '受け取る', delta: { evid: +1 } },
          { label: '戻させる', delta: { trust: +1 } }
        ]
      },
      // 20 低い声
      {
        bg: BG.hallway, speaker: '',
        text: '配膳中、見知らぬ低い声が「それは私のだ」。周りには誰もいない。',
        choices: [
          { label: '手を止める', delta: { shadow: +2 } },
          { label: '無視して続ける', delta: { trust: +1 } }
        ]
      }
    ];

    // ゲーム初期化実行
    console.log('ゲーム準備完了');
    init();
  </script>
</body>
</html>
